!function(){"use strict";function e(e,t,o){var s;if("undefined"!=typeof XMLHttpRequest)s=new XMLHttpRequest;else for(var n=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],i=0,r=n.length;r>i;i++)try{s=new ActiveXObject(n[i]);break}catch(l){}s.onreadystatechange=function(){4===s.readyState&&o(s)},s.open("GET",e,!0),t&&s.setRequestHeader&&Object.keys(t).forEach(function(e,o){s.setRequestHeader(e,t[e])}),s.send("")}var t=!1;void 0===window.Kloudless&&(window.Kloudless={}),window.Kloudless.baseUrl="https://api.kloudless.com",window.Kloudless.apiVersion="v1",window.Kloudless._authenticators={},window.Kloudless._authenticators_by_element={},window.Kloudless._authenticator_iframe=void 0,window.Kloudless._popup=void 0;var o=navigator.userAgent.toLowerCase(),s=!1,n=-1;-1!==o.indexOf("msie")?(s=!0,n=parseInt(o.split("msie")[1])):-1!==o.indexOf("trident/")&&(s=!0,n=parseInt(o.split("rv:")[1])),window.addEventListener("message",function(e){var o="kloudless:";if(t&&console.log("[DEBUG] Message received",e),e.origin!==window.Kloudless.baseUrl)return void console.log("[ERROR] Origin mismatch:",e);if(0!==e.data.indexOf(o))return void console.log("[ERROR] Namespace mismsatch:",e);var n=JSON.parse(e.data.substring(o.length));return"authentication"!=n.type?void console.log("[ERROR] Incorrect content type:",e):(setTimeout(function(){var e=window.Kloudless._authenticators[n.id];e?e.callback(n.data):console.log("[ERROR] No Authenticator found for ID:",n.id)},0),s?e.source.postMessage("kloudless:"+JSON.stringify({type:"close"}),e.origin):window.Kloudless._popup&&(window.Kloudless._popup.close(),window.Kloudless._popup=void 0),void(t&&console.log("[DEBUG] Confirmation sent",e.origin)))},!1);var i=function(e){var t="/services/";return"string"==typeof e.services&&(e.services=[e.services]),void 0===e.services?t+="?":1==e.services.length?t+=e.services[0]+"?":e.services.length>1&&(t+="?services="+e.services.map(function(e){return e.trim()}).join(",")+"&"),t+="app_id="+e.app_id+"&admin="+(e.admin?1:"")+"&extra="+(e.extra?e.extra:"")+"&callback=&retrieve_account_key=",e.group&&(t+="&group="+e.group),e.edit_account&&(t+="&edit_account="+e.edit_account),e.developer&&(t+="&developer=true"),t},r=function(e){var t="/"+window.Kloudless.apiVersion+"/oauth/?";return e.redirect_uri="urn:ietf:wg:oauth:2.0:oob",e.response_type="token",e.state=parseInt(Math.random()*Math.pow(10,10)),Object.keys(e).forEach(function(o,s){var n=e[o];"scopes"==o&&n.join&&(n=n.join(" ")),t+="&"+o+"="+n}),t},l=function(){if(void 0===window.Kloudless._authenticator_iframe){var e=document.createElement("iframe");e.setAttribute("id","kloudless_iexd"),e.setAttribute("src",window.Kloudless.baseUrl+"/static/iexd.html"),e.style.display="none",document.getElementsByTagName("body")[0].appendChild(e),window.Kloudless._authenticator_iframe=e}},a=function(e){return function(t){e(null,t)}},d=function(t,o){return function(s){if(!s.state||s.state.toString()!==o.toString())return t({error:"invalid_state"});if(!s.access_token)return t(s);var n={Authorization:"Bearer "+s.access_token};e(window.Kloudless.baseUrl+"/"+window.Kloudless.apiVersion+"/oauth/token/",n,function(o){200!==o.status&&t(s);var i=JSON.parse(o.responseText).account_id;e(window.Kloudless.baseUrl+"/"+window.Kloudless.apiVersion+"/accounts/"+i+"/?retrieve_full=False",n,function(e){200===e.status&&(s.account=JSON.parse(e.responseText)),t(s)})})}};window.Kloudless.authenticator=function(e,o,n){if(l(),void 0!==window.jQuery&&e instanceof window.jQuery&&(e=e.get(0)),!o.client_id&&!o.app_id)throw new Error("An App ID is required.");var u;o.app_id?(u=i(o),n=a(n)):(u=r(o),n=d(n,o.state));var c=parseInt(Math.random()*Math.pow(10,10)),w=window.location.protocol+"//"+window.location.host;u+="&request_id="+c,u+="&origin="+encodeURIComponent(w),t&&console.log("[DEBUG]","Path is",window.Kloudless.baseUrl+u);var p=function(){var e=600,t=1e3,o=(screen.height-e)/2-50,n=(screen.width-t)/2,i="resizable,scrollbars,status,height="+e+",width="+t+",top="+o+",left="+n;if(s){var r={type:"prepareToOpenAuthenticator",url:window.Kloudless.baseUrl+u,params:i},l=window.Kloudless._authenticator_iframe;l.contentWindow.postMessage("kloudless:"+JSON.stringify(r),l.src),l.style.position="fixed",l.style.display="block",l.style.height="100%",l.style.width="100%",l.style.top="0",l.style.bottom="0",l.style.left="0",l.style.right="0";var a=1,d=setInterval(function(){.75>=a&&(clearInterval(d),l.style.display="none"),l.style.opacity=a,l.style.filter="alpha(opacity="+100*a+")",a-=.01*a},120)}else window.Kloudless._popup=window.open(window.Kloudless.baseUrl+u,"kPOPUP",i),window.Kloudless._popup.focus()};void 0!==window.Kloudless._authenticators_by_element[e.outerHTML]&&window.Kloudless.stop(e),window.Kloudless._authenticators[c]={clickHandler:p,callback:n},window.Kloudless._authenticators_by_element[e.outerHTML]=c,e.addEventListener("click",p)},window.Kloudless.stop=function(e){void 0!==window.jQuery&&e instanceof window.jQuery&&(e=e.get(0));var t=window.Kloudless._authenticators_by_element[e.outerHTML];if(t){var o=window.Kloudless._authenticators[t];e.removeEventListener("click",o.clickHandler),delete window.Kloudless._authenticators[t],delete window.Kloudless._authenticators_by_element[e.outerHTML]}else console.log("No click listener found to remove.")}}();
!function(){"use strict";if(window.Event.prototype.preventDefault||(window.Event.prototype.preventDefault=function(){this.returnValue=!1}),!Element.prototype.addEventListener){var e=[],t=function(t,n){var o=this,r=function(e){e.target=e.srcElement,e.currentTarget=o,n.handleEvent?n.handleEvent(e):n.call(o,e)};this.attachEvent("on"+t,r),e.push({object:this,type:t,listener:n,wrapper:r})},n=function(t,n){for(var o=0;o<e.length;){var r=e[o];if(r.object==this&&r.type==t&&r.listener==n){this.detachEvent("on"+t,r.wrapper);break}++o}};Element.prototype.addEventListener=t,Element.prototype.removeEventListener=n,window.HTMLDocument&&(window.HTMLDocument.prototype.addEventListener=t,window.HTMLDocument.prototype.removeEventListener=n),window.Window&&(window.Window.prototype.addEventListener=t,window.Window.prototype.removeEventListener=n)}}();